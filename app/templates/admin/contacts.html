<!DOCTYPE html>
<html><head><meta charset="utf-8"><link rel="stylesheet" href="/static/css/style.css"><title>Контакты</title></head>
<body>
<header>
  <div class="brand">Контакты</div>
  <div class="header-actions">
    <a class="button ghost" href="/admin">Меню</a>
    <a class="button" href="/admin/logout">Выйти</a>
  </div>
</header>
<div class="container">
  <div class="main">
    <div class="admin-nav">
      <a href="/admin/departments">Отделы</a>
      <a href="/admin/banners">Баннеры</a>
      <a href="/admin/users">Пользователи</a>
      <a href="/admin/settings">Настройки</a>
    </div>
    {% if error %}<div class="alert">{{ error }}</div>{% endif %}
    <h3>Новый контакт</h3>
    <form method="post">
      <div class="form-row"><input name="full_name" placeholder="ФИО" required></div>
      <div class="form-row">
        <select name="department_id">
          {% for d in departments %}
            <option value="{{ d.id }}">{{ d.name }}</option>
          {% endfor %}
        </select>
      </div>
      <button class="button" type="submit">Создать</button>
    </form>

    <h3>Список</h3>
    <table class="table">
      <tr><th>ФИО</th><th>Отдел</th><th>Телефоны</th><th>Статус</th><th>Действия</th></tr>
      {% for c in contacts %}
        <tr>
          <td>{{ c.full_name }}</td>
          <td>{{ c.department.name }}</td>
          <td>
            {% for cp in c.phones %}
              {{ cp.phone.type }}: {{ cp.phone.number }}<br>
            {% endfor %}
          </td>
          <td>{% if c.is_archived %}Архив{% else %}Активен{% endif %}</td>
          <td>
            {% if not c.is_archived %}
              <form method="post" action="/admin/contacts/{{ c.id }}/archive" style="display:inline"><button class="button secondary">Архив</button></form>
            {% else %}
              <form method="post" action="/admin/contacts/{{ c.id }}/restore" style="display:inline"><button class="button">Восстановить</button></form>
            {% endif %}
            <details>
              <summary>Телефоны</summary>
              <form method="post" action="/admin/contacts/{{ c.id }}/phones">
                <textarea name="phone_types" rows="3" placeholder="Типы по строкам (city/internal/ip)"></textarea><br>
                <textarea name="phone_numbers" rows="3" placeholder="Номера по строкам"></textarea><br>
                <button class="button" type="submit">Сохранить телефоны</button>
              </form>
            </details>
          </td>
        </tr>
      {% endfor %}
    </table>
  </div>
</div>
</body></html>
