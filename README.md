# Телефонный справочник (MVP)

## Запуск
1. Скопируйте `.env.example` в `.env` и при необходимости измените переменные.
2. Выполните (если используете Podman, замените на `podman-compose`):
```bash
docker-compose up --build
```
Приложение будет доступно на http://localhost:8000.

Alembic миграции применяются автоматически перед запуском приложения.

## Доступ в админку
- URL: http://localhost:8000/admin
- Логин: `admin`
- Пароль: `admin123`

## Демо-данные
При первом запуске создаются примерные отделы, контакты и номера, включая общий номер для двух людей, а также баннеры-заглушки.

## Импорт/Экспорт
- Страница: `/admin/import-export`
- Экспорт: CSV или XLSX.
- Формат импорта (CSV/XLSX):
```
DepartmentPath,FullName,PhonesCity,PhonesInternal,PhonesIP,Archived
Центр ИТ / Отдел разработки,Иван Петров,123-45-67,101,,0
```
- Ключ обновления: `DepartmentPath + FullName`.
- Режим: `replace` (телефоны полностью заменяются списком из файла).
- Нарушение лимита `max_contacts_per_phone` для номера — строка попадает в ошибки и не импортируется.

## Лимит привязок номеров
По умолчанию лимит задаётся настройкой `max_contacts_per_phone`. Для демо данных значение автоматически выставляется минимум в `2`, чтобы показать сценарий «один номер у нескольких людей». В настройках `/admin/settings` можете вернуть значение `1`, если нужно строгое ограничение.

## docker-compose
- `app`: FastAPI + Jinja2 + SQLAlchemy
- `db`: PostgreSQL 15
- volume `uploads` для баннеров и `db_data` для БД.

## Настройки
- `max_contacts_per_phone` меняется в `/admin/settings`.
